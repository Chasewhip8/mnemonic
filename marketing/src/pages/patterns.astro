---
import Base from '../layouts/Base.astro';
import SEO from '../components/SEO.astro';

const integrations = [
  {
    name: "CI/CD → local agent",
    from: "GitHub Action posts to /learn on deploy failure",
    to: "Claude injects before your next deploy attempt",
    signal: "Cross-environment recall with zero config",
  },
  {
    name: "Slack bot → ops agent",
    from: "Slack bot stores incident context via REST",
    to: "On-call agent queries past incidents on page",
    signal: "Production knowledge survives team rotation",
  },
  {
    name: "CLI script → MCP client",
    from: "Bash script curls /learn after migration",
    to: "Cursor recalls migration gotchas in-editor",
    signal: "Terminal wisdom flows into your IDE",
  },
  {
    name: "Cron → all agents",
    from: "Scheduled job prunes stale memories nightly",
    to: "Every agent starts with a clean, current memory",
    signal: "Self-maintaining shared context",
  },
];

const patterns = [
  {
    category: "Recall",
    items: [
      { prompt: "what was the last thing we worked on?", desc: "Agent queries recent memories to restore context." },
      { prompt: "what do you know about deployments?", desc: "Semantic search across all learnings for a topic." },
      { prompt: "anything relevant before I start this?", desc: "Pre-task injection of related memories." },
    ]
  },
  {
    category: "Learning",
    items: [
      { prompt: "remember this for next time", desc: "Explicit signal to store current context as a learning." },
      { prompt: "that worked — save it", desc: "Positive reinforcement, high confidence learning." },
      { prompt: "don't do that again", desc: "Negative learning from failure, stored for avoidance." },
    ]
  },
  {
    category: "Organization",
    items: [
      { prompt: "organize your memory how you see fit", desc: "Agent autonomously categorizes and scopes learnings." },
      { prompt: "clean up low-confidence memories", desc: "Prune uncertain learnings to reduce noise." },
      { prompt: "what scopes are you using?", desc: "Introspect memory organization structure." },
    ]
  },
  {
    category: "Maintenance",
    items: [
      { prompt: "any outdated memories?", desc: "Find learnings that may no longer be accurate." },
      { prompt: "delete memories about [old project]", desc: "Targeted cleanup of stale context." },
      { prompt: "consolidate duplicate learnings", desc: "Merge similar memories to reduce redundancy." },
    ]
  },
  {
    category: "Scoping",
    items: [
      { prompt: "this is session-only, don't persist", desc: "Temporary memory that auto-expires." },
      { prompt: "share this with all agents", desc: "Store in shared scope for cross-agent access." },
      { prompt: "keep this private to us", desc: "Agent-scoped memory, isolated from others." },
    ]
  },
  {
    category: "Debugging",
    items: [
      { prompt: "show me your recent learnings", desc: "List what's been stored in current session." },
      { prompt: "why did you recall that?", desc: "Explain semantic match reasoning." },
      { prompt: "what confidence do you have?", desc: "Surface confidence scores on memories." },
    ]
  },
];
---

<Base title="Patterns — deja">
  <SEO
    slot="head"
    title="Patterns — deja"
    description="Prompt patterns for working with deja-enabled agents. Learn how to recall memories, store learnings, and organize agent knowledge."
    keywords="agent prompts, memory patterns, ai prompts, deja patterns, agent memory prompts"
    path="/patterns"
    type="article"
    section="Patterns"
    breadcrumbs={[{ name: 'Patterns', path: '/patterns' }]}
  />
  <section class="pt-16 pb-8">
    <div class="bg-void/90 backdrop-blur-sm border border-brass/10 rounded-sm p-8 md:p-10 shadow-hero">
      <div class="font-mono text-[11px] font-bold tracking-widest uppercase text-brass mb-4">Patterns</div>
      <h1 class="font-serif-sc text-4xl md:text-5xl font-bold tracking-tight m-0 mb-4">
        How to talk to an agent with deja
      </h1>
      <p class="font-serif font-light text-lg text-chrome-dark max-w-3xl m-0">
        These prompts work when your agent has deja in its system prompt. Speak naturally — the agent handles the API.
      </p>
    </div>
  </section>

  <div class="grid gap-6 mt-12 grid-cols-1 lg:grid-cols-2">
    {patterns.map(({ category, items }) => (
      <div class="bg-steel border border-brass/10 rounded-sm relative shadow-card">
        <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-brass to-transparent opacity-30"></div>
        <div class="px-6 pt-5 pb-2">
          <h2 class="font-mono text-[10px] font-bold uppercase tracking-widest text-brass m-0">{category}</h2>
        </div>
        <div class="divide-y divide-brass/10">
          {items.map(({ prompt, desc }) => (
            <div class="px-6 py-3 hover:bg-brass/5 transition-colors">
              <code class="font-mono text-xs text-chrome">"{prompt}"</code>
              <div class="font-serif text-sm text-chrome-dark/70 mt-1">{desc}</div>
            </div>
          ))}
        </div>
      </div>
    ))}
  </div>

  <section class="mt-12">
    <div class="bg-steel border border-brass/10 rounded-sm relative shadow-card">
      <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-brass to-transparent opacity-30"></div>
      <div class="px-6 pt-5 pb-2">
        <h2 class="font-mono text-[10px] font-bold uppercase tracking-widest text-brass m-0">Integration</h2>
        <p class="font-serif font-light text-sm text-chrome-dark/70 mt-1 m-0">
          Memories flow across completely different systems. deja is just HTTP.
        </p>
      </div>
      <div class="divide-y divide-brass/10">
        {integrations.map(({ name, from, to, signal }) => (
          <div class="px-6 py-4 hover:bg-brass/5 transition-colors">
            <div class="font-mono text-[11px] font-bold tracking-widest uppercase text-brass mb-2">{name}</div>
            <div class="flex flex-col md:flex-row md:items-center gap-1 md:gap-3">
              <span class="font-serif text-sm text-chrome-dark">{from}</span>
              <span class="font-mono text-brass text-xs hidden md:inline">&rarr;</span>
              <span class="font-serif text-sm text-chrome-dark">{to}</span>
            </div>
            <div class="font-mono text-[11px] text-chrome-dark/40 mt-1">{signal}</div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <section class="mt-16 mb-8">
    <div class="bg-steel border border-brass/10 rounded-sm p-6 relative shadow-card">
      <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-brass to-transparent opacity-30"></div>
      <h3 class="font-serif font-semibold text-xl tracking-tight m-0 mb-3">Adding deja to your agent's system prompt</h3>
      <p class="font-serif font-light text-chrome-dark m-0 mb-4">
        Include something like this in your agent's instructions:
      </p>
      <div class="code-block bg-void-deep border border-brass/10 rounded-sm p-4 font-mono text-xs leading-relaxed text-chrome-dark overflow-x-auto whitespace-pre shadow-code">You have access to persistent memory via deja.

<span class="flag">To learn:</span> Call mem.learn(trigger, learning) after completing tasks.
<span class="flag">To recall:</span> Call mem.inject(context) before starting tasks.

Store learnings with appropriate scope:
- "shared" for knowledge useful to all agents
- "agent:name" for agent-specific patterns
- "session:id" for temporary context

Proactively organize and maintain your memories.</div>
    </div>
  </section>
</Base>
