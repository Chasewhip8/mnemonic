---
import FailureModeLayout from '../../layouts/FailureModeLayout.astro';
import DoItWithDeja from '../../components/DoItWithDeja.astro';
import { getFailureModeBySlug } from '../../data/research';
const failureMode = getFailureModeBySlug('stale-memory-wont-die')!;
---

<FailureModeLayout failureMode={failureMode}>
  <Fragment slot="toc">
    <a href="#scenario" class="block py-1 text-[12px] font-serif text-chrome-dark/50 hover:text-brass transition-colors">Scenario</a>
    <a href="#what-was-needed" class="block py-1 text-[12px] font-serif text-chrome-dark/50 hover:text-brass transition-colors">What was needed</a>
    <a href="#minimal-interface" class="block py-1 text-[12px] font-serif text-chrome-dark/50 hover:text-brass transition-colors">Minimal interface</a>
    <a href="#do-it-with-deja" class="block py-1 text-[12px] font-serif text-chrome-dark/50 hover:text-brass transition-colors">Do it with deja</a>
  </Fragment>

  <h2 id="scenario">Scenario</h2>
  <p>A deprecated API is still in memory with high confidence. The agent keeps suggesting it. You've fixed the codebase; the memory didn't get the memo. You need to find that one belief and kill it — or at least drop its confidence so it stops surfacing.</p>

  <h2 id="what-was-needed">What was needed</h2>
  <p>Search or filter over shared learnings by trigger text or topic. One row per memory. Actions: delete, or lower confidence. No bulk dashboard, no timeline — just "find this, fix this." A filing-cabinet slice, not the full cabinet.</p>

  <h2 id="minimal-interface">Minimal interface</h2>
  <p>A search box and a table. Type the deprecated API name or a keyword; see matching learnings with trigger, learning, confidence. Row actions: Delete, or PATCH confidence down (e.g. to 0.2). Optional: "Dispute" that adds metadata so it's excluded from inject until reviewed. The goal is surgical removal of one bad memory, not a full admin experience.</p>

  <DoItWithDeja
    blurb="GET /learnings?scope=shared, filter client-side by trigger text. DELETE or PATCH confidence for the offending memory."
    snippets={[
      {
        label: 'List shared, then delete or patch',
        code: `curl -X GET "https://deja.your-subdomain.workers.dev/learnings?scope=shared&limit=100" \\
  -H "Authorization: Bearer YOUR_API_KEY"
# Filter client-side for trigger/learning containing deprecated term
# Then:
curl -X DELETE "https://deja.your-subdomain.workers.dev/learnings/MEMORY_ID" -H "Authorization: Bearer YOUR_API_KEY"
# Or lower confidence:
curl -X PATCH "https://deja.your-subdomain.workers.dev/learnings/MEMORY_ID" \\
  -H "Content-Type: application/json" -d '{"confidence": 0.2}'`,
      },
    ]}
  />
</FailureModeLayout>
